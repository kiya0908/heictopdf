<!DOCTYPE html>
<html>
<head>
    <title>Creem API å‰ç«¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; white-space: pre-wrap; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ”¬ Creem API å‰ç«¯æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>é…ç½®ä¿¡æ¯</h3>
        <div id="config" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>APIè¿æ¥æµ‹è¯•</h3>
        <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
        <button onclick="testProducts()">æµ‹è¯•Productsç«¯ç‚¹</button>
        <button onclick="testBundle()">æµ‹è¯•Bundleç«¯ç‚¹</button>
        <div id="connectionResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>æ”¯ä»˜æµ‹è¯•</h3>
        <button onclick="testCheckout()">æµ‹è¯•Checkoutåˆ›å»º</button>
        <div id="checkoutResult" class="result"></div>
    </div>

    <script>
        // é…ç½®
        const CONFIG = {
            API_KEY: 'creem_test_4g41oSxGmAZ0SvE0EGTFaV',
            BASE_URL: 'https://test-api.creem.io',
            BUNDLE_ID: 'bund_3rus8VatGglCRdoMDKih3O'
        };
        
        // æ˜¾ç¤ºé…ç½®
        document.getElementById('config').textContent = JSON.stringify(CONFIG, null, 2);
        
        async function logResult(elementId, message, isSuccess = false) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
        }
        
        async function makeRequest(url, options = {}) {
            const headers = {
                'Authorization': `Bearer ${CONFIG.API_KEY}`,
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            const response = await fetch(url, {
                method: options.method || 'GET',
                headers,
                body: options.body ? JSON.stringify(options.body) : undefined
            });
            
            const data = await response.json().catch(() => response.text()).catch(() => 'No content');
            
            return {
                status: response.status,
                statusText: response.statusText,
                data,
                success: response.ok
            };
        }
        
        async function testConnection() {
            try {
                logResult('connectionResult', 'ğŸ”„ æµ‹è¯•æ ¹è·¯å¾„è¿æ¥...');
                
                const result = await makeRequest(`${CONFIG.BASE_URL}/`);
                
                const message = `æ ¹è·¯å¾„æµ‹è¯•ç»“æœ:
çŠ¶æ€: ${result.status} ${result.statusText}
å“åº”: ${typeof result.data === 'string' ? result.data : JSON.stringify(result.data, null, 2)}`;
                
                logResult('connectionResult', message, result.success);
            } catch (error) {
                logResult('connectionResult', `âŒ è¿æ¥å¤±è´¥: ${error.message}`);
            }
        }
        
        async function testProducts() {
            try {
                logResult('connectionResult', 'ğŸ”„ æµ‹è¯•Productsç«¯ç‚¹...');
                
                const result = await makeRequest(`${CONFIG.BASE_URL}/products`);
                
                const message = `Productsç«¯ç‚¹æµ‹è¯•ç»“æœ:
çŠ¶æ€: ${result.status} ${result.statusText}
å“åº”: ${typeof result.data === 'string' ? result.data : JSON.stringify(result.data, null, 2)}`;
                
                logResult('connectionResult', message, result.success);
            } catch (error) {
                logResult('connectionResult', `âŒ Productsæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        async function testBundle() {
            try {
                logResult('connectionResult', 'ğŸ”„ æµ‹è¯•Bundleç«¯ç‚¹...');
                
                const bundleUrl = `${CONFIG.BASE_URL}/bundles/${CONFIG.BUNDLE_ID}`;
                const result = await makeRequest(bundleUrl);
                
                const message = `Bundleç«¯ç‚¹æµ‹è¯•ç»“æœ:
URL: ${bundleUrl}
çŠ¶æ€: ${result.status} ${result.statusText}
å“åº”: ${typeof result.data === 'string' ? result.data : JSON.stringify(result.data, null, 2)}`;
                
                logResult('connectionResult', message, result.success);
            } catch (error) {
                logResult('connectionResult', `âŒ Bundleæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        async function testCheckout() {
            try {
                logResult('checkoutResult', 'ğŸ”„ æµ‹è¯•Checkoutä¼šè¯åˆ›å»º...');
                
                const checkoutData = {
                    bundle_id: CONFIG.BUNDLE_ID,
                    customer_email: 'test@example.com',
                    success_url: 'http://localhost:3000/success',
                    cancel_url: 'http://localhost:3000/cancel'
                };
                
                const result = await makeRequest(`${CONFIG.BASE_URL}/checkout`, {
                    method: 'POST',
                    body: checkoutData
                });
                
                const message = `Checkoutåˆ›å»ºæµ‹è¯•ç»“æœ:
è¯·æ±‚æ•°æ®: ${JSON.stringify(checkoutData, null, 2)}
çŠ¶æ€: ${result.status} ${result.statusText}
å“åº”: ${typeof result.data === 'string' ? result.data : JSON.stringify(result.data, null, 2)}`;
                
                logResult('checkoutResult', message, result.success);
                
                if (result.success && (result.data.url || result.data.checkout_url)) {
                    logResult('checkoutResult', message + '\n\nğŸ‰ è·å¾—äº†æ”¯ä»˜URL! å¯ä»¥å°è¯•é‡å®šå‘åˆ°æ”¯ä»˜é¡µé¢ã€‚', true);
                }
            } catch (error) {
                logResult('checkoutResult', `âŒ Checkoutæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        // è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.onload = () => {
            testConnection();
        };
    </script>
</body>
</html>